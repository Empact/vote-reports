<% title "Report - #{h @report.name} - Edit Criteria" %>

<div class="section">
  <%= render 'reports/header', :report => @report %>

  <h2>Edit Bill Criteria</h2>
  <%- if @report.bill_criteria.empty? -%>
    <p>This report doesn't have any bills selected</p>
    <%= link_to 'Back', :back %>
  <%- else -%>
    <% form_for [@report.user, @report] do |f| %>
      <table>
        <thead>
          <th>Bill</th>
          <th>Support/Oppose</th>
          <th><span class="info" title="This will be linked from the support/oppose declaration on the report page">Explanatory Link</span></th>
          <td></td>
        </thead>
        <tbody>
          <%- @report.bill_criteria.each do |criterion| -%>
            <%- f.fields_for :bill_criteria, criterion do |bill_criteria_fields| -%>
              <tr>
                <td>
                  <%= render 'bills/bill', :bill => criterion.bill %>
                  <%= bill_criteria_fields.hidden_field :bill_id %>
                  <%= bill_criteria_fields.hidden_field :id unless criterion.new_record? %>
                </td>
                <td>
                  <%= bill_criteria_fields.label :support_true, 'Support' %>
                  <%= bill_criteria_fields.radio_button :support, true %><br />
                  <%= bill_criteria_fields.label :support_false, 'Oppose' %>
                  <%= bill_criteria_fields.radio_button :support, false %>
                </td>
                <td>
                  <%= bill_criteria_fields.label :explanatory_url, 'Explanatory Link', :class => 'hidden' %>
                  <%= bill_criteria_fields.text_field :explanatory_url, :size => '20' %>
                </td>
                <td>
                  <%= link_to('Remove', user_report_bill_criterion_path(current_user, @report, criterion),
                            :method => :delete,
                            :title => "Delete criterion for '#{criterion.bill.titles.first}'",
                            :confirm => "Are you sure you want to delete the criterion for '#{criterion.bill.titles.first}'?") -%>
                </td>
              </tr>
            <%- end -%>
          <%- end -%>
        </tbody>
      </table>
      <ul class="actions_menu">
        <li><%= f.submit 'Save Bill Criteria' %></li>
        <li><%= link_to 'Back to Edit', edit_user_report_path(@report.user, @report) %></li>
        <li><%= link_to 'Back to Report', user_report_path(@report.user, @report) %></li>
      </ul>
    <% end %>
  <%- end -%>
</div>