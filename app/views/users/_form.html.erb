<%-
  pass_through ||= false
  url ||= users_path
-%>

<% form_for user, :url => url do |f| %>
  <%= f.error_messages %>
  <p>
    <%= f.label :username %><br />
    <%= f.text_field :username %><br />

    <%= f.label :email %><br />
    <%= f.text_field :email %><br />

    <%- if user.rpx_identifiers.present? -%>
      <p>You've linked to an existing account to log in with, so no other password is needed.</p>
    <%- else -%>
      <%= f.label :password %><br />
      <%= f.password_field :password %><br />

      <%= f.label :password_confirmation %><br />
      <%= f.password_field :password_confirmation %><br />
    <%- end -%>

    <%- if pass_through -%>
      <%- params.each_pair do |key, value| -%>
        <%= hidden_field_tag key, value %>
      <%- end -%>
    <%- end -%>

    <%= f.submit user.new_record? ? "Sign up" : "Save Changes" %>
  </p>
<% end %>
