<%- categories, data = [], [] -%>
<%- score.evidence.group_by(&:subject).each_pair do |subject, subject_scores| -%>
  <%- notify_hoptoad("Multiple interest group ratings #{subject_scores.inspect}") if subject_scores.size > 1 -%>
  <%- rating = subject_scores.first.evidence -%>
  <%- categories << subject.timespan.to_s -%>
  <%- data << rating.numeric_rating -%>
  <!-- [subject.timespan, rating.numeric_rating.round] -->
  <%# link_to "In #{subject.timespan}: #{rating.numeric_rating.round}%", subject.vote_smart_url %>
  <%# rating.description %>
<%- end -%>

<% javascript_tag do %>
  new Highcharts.Chart({
    chart: {
      renderTo: '<%= dom_id(score, :evidence) %>',
      defaultSeriesType: 'line',
    },
    title: {
      text: '<%= escape_javascript(score_title(score)) %>',
    },
    subtitle: {
      text: 'based on <%= escape_javascript(score_evidence_components(score).join(', ')) %>',
    },
    xAxis: {
      categories: <%= categories.inspect.gsub('"', "'") %>,
      title: {
         text: 'Month'
      }
    },
    yAxis: {
      title: {
         text: 'Rating'
      },
      plotLines: [{
         value: 0,
         width: 1,
         color: '#808080'
      }]
    },
    tooltip: {
      formatter: function() {
        return '<b>'+ this.series.name +'</b><br/>'+ this.x +': '+ this.y +'Â°C';
      }
    },
    legend: {
      enabled: false
    },
    series: [{
      type: 'line',
      data: <%= data.inspect %>
    }]
  });
<% end %>

<% div_for(score, :evidence, :style => "width: 100%; height: 400px") do %>
<% end %>
