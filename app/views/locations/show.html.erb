<% title 'Your Districts' %>

<div style="min-width: 750px">
  <div class="left">
    <h2>
      <% form_tag location_path, :'data-replace' => (@js ? 'fancybox-inner' : 'content')  do %>
        <%= label_tag :location, 'Your Location', :style => 'font-weight: normal;' %>
        <%= text_field_tag :location, session[:location] %>
        <%= submit_tag 'Set' %>
      <% end %>
    </h2>

    <div id="map_canvas" style="height: 30em;"></div>
  </div>

  <div class="right">
    <h2>Your Representatives for <%= @federal.display_name %></h2>
    <div class="clearfix">
      <div class="left">
        <h3>Senators</h3>
        <%- @politicians.senators.each do |politician| -%>
          <%= render 'politicians/politician', :politician => politician %>
        <%- end -%>
      </div>
      <div class="right">
        <h3>Representative</h3>
        <%- @politicians.representatives.each do |politician| -%>
          <%= render 'politicians/politician', :politician => politician %>
        <%- end -%>
      </div>
    </div>
  </div>

  <% javascript_tag do %>
  <%- if @js -%>
    function init_map() {
  <%- else -%>
    $(function () {
  <%- end -%>

      show_location_map = new google.maps.Map(document.getElementById("map_canvas"), {
        mapTypeControl: false,
        mapTypeId: google.maps.MapTypeId.ROADMAP
      });
      show_location_map.fitBounds(<%= mapy(@bounds) %>);

      var info_content = '';

      <%- @districts.each do |district| -%>
        district_<%= district.id %> = new google.maps.Polygon({
          paths: [
          <%- district.linear_ring.each do |point| -%>
            <%= mapy(point) %>,
          <%- end -%>
          ],
          strokeColor: "<%= district.level.stroke_color %>",
          strokeOpacity: 0.8,
          strokeWeight: 1,
          fillColor: "<%= district.level.fill_color %>",
          fillOpacity: 0.3
        });
        district_<%= district.id %>.setMap(show_location_map);
        info_content += '<a style="color: <%= district.level.text_color %>;" onclick="togglePolygon(show_location_map, district_<%= district.id %>)"><%= district.full_name %></a><br />'
      <%- end -%>

      var districtInfo = new google.maps.InfoWindow({
          content: info_content
      });

      var location = new google.maps.Marker({
        position: <%= mapy(@geoloc) %>,
        map: show_location_map,
        title: "Your Location"
      });

      google.maps.event.addListener(location, 'click', function() {
        districtInfo.open(show_location_map,location);
      });

  <%- if @js -%>
    }
  <%- else -%>
    });
  <%- end -%>
  <% end %>
</div>
